<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>LEGO DC Comics Super Heroes: The Flash</title>
  <link href="https://fonts.googleapis.com/css2?family=Netflix+Sans:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:#000; color:#fff; font-family:'Netflix Sans',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif; overflow-x:hidden; line-height:1.5; }
    .backdrop { position:fixed; top:0; left:0; right:0; bottom:0;
      background:linear-gradient(to bottom,rgba(0,0,0,0.7)0%,rgba(0,0,0,0.9)100%),url('https://image.tmdb.org/t/p/original/uSVXTWbdPPpiecRlGvIZrz9gc8Q.jpg') center/cover no-repeat;
      filter:blur(8px) brightness(0.6); z-index:-1; transform:scale(1.1); }
    .container { max-width:480px; margin:0 auto; padding:0 16px; }
    .header { padding-top:60px; text-align:center; position:relative; }
    .poster { width:160px; height:240px; border-radius:8px; overflow:hidden; margin:0 auto 16px;
      box-shadow:0 8px 24px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.1); }
    .poster img { width:100%; height:100%; object-fit:cover; }
    .movie-logo { margin:12px auto; max-width:200px; max-height:60px; object-fit:contain;
      filter:drop-shadow(0 2px 4px rgba(0,0,0,0.8)); display:block; }
    .title { font-size:28px; font-weight:900; margin-bottom:8px; text-shadow:0 2px 4px rgba(0,0,0,0.8); }
    .meta { font-size:14px; color:#aaa; margin-bottom:16px; }
    .meta span { margin-right:12px; }
    .match { color:#46d369; font-weight:700; }
    .actions { display:flex; justify-content:center; gap:16px; margin:24px 0; }
    .btn { display:flex; flex-direction:column; align-items:center; gap:6px;
      background:none; border:none; color:#fff; font-size:12px; font-weight:500;
      cursor:pointer; transition:transform .2s ease; }
    .btn:active { transform:scale(0.92); }
    .btn-icon { width:52px; height:52px; border-radius:50%; background:rgba(255,255,255,0.15);
      display:flex; align-items:center; justify-content:center; font-size:20px; transition:all .25s ease; }
    .btn-play .btn-icon { background:#fff; color:#000; font-size:24px; }
    .btn:hover .btn-icon { background:rgba(255,255,255,0.3); }
    .btn-play:hover .btn-icon { background:#e6e6e6; }

    /* ESTADO AÑADIDO */
    .btn.added .btn-icon {
      background: #46d369 !important;
      color: white !important;
    }
    .btn.added:hover .btn-icon {
      background: #3bb35a !important;
    }
    .btn.added span {
      color: #46d369;
      font-weight: 600;
    }

    .btn-download { margin-top:16px; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.3);
      color:#fff; padding:12px 24px; border-radius:4px; font-weight:600; width:100%;
      font-size:15px; display:flex; align-items:center; justify-content:center; gap:8px;
      transition:all .2s ease; }
    .btn-download:active { background:rgba(255,255,255,0.2); transform:scale(0.98); }
    .synopsis { font-size:15px; color:#ccc; line-height:1.6; margin:24px 0; }
    .synopsis-title { color:#fff; font-weight:700; margin-bottom:8px; font-size:16px; }

    /* RECOMENDADOS */
    .recommended-section {
      margin: 32px 0 40px;
    }
    .section-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
      color: #fff;
    }
    .scroll-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 8px;
      margin-bottom: -8px;
    }
    .scroll-container::-webkit-scrollbar {
      display: none;
    }
    .recommended-grid {
      display: flex;
      gap: 12px;
      list-style: none;
      padding: 0;
      margin: 0;
      scroll-snap-type: x mandatory;
    }
    .recommended-grid li {
      flex: 0 0 110px;
      scroll-snap-align: start;
    }
    .recommended-grid a {
      display: block;
      text-decoration: none;
      color: inherit;
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.2s ease;
    }
    .recommended-grid a:hover,
    .recommended-grid a:focus {
      transform: scale(1.08);
      outline: 2px solid #46d369;
      outline-offset: 2px;
    }
    .recommended-grid img {
      width: 100%;
      aspect-ratio: 2/3;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      display: block;
    }
    .recommended-grid .title {
      font-size: 12px;
      font-weight: 600;
      margin-top: 6px;
      text-align: center;
      color: #fff;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding: 0 4px;
    }

    #infoModal, #videoModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.7); backdrop-filter:blur(6px); z-index:9999;
      justify-content:center; align-items:center; padding:16px; box-sizing:border-box; }
    #infoModal > div, #videoModal > div { background:#111; padding:24px; border-radius:12px;
      max-width:400px; width:90%; max-height:80%; overflow-y:auto; position:relative; }
    #closeModal, #closeVideoModal { position:absolute; top:12px; right:12px; background:none;
      border:none; color:#fff; font-size:20px; cursor:pointer; }
    #videoModal::before { content:''; position:absolute; top:0; left:0; right:0; bottom:0;
      background:url('https://image.tmdb.org/t/p/original/uSVXTWbdPPpiecRlGvIZrz9gc8Q.jpg') center/cover; filter:blur(20px) brightness(0.3); z-index:-1; }
    #videoModal > div { background:#000; box-shadow:0 20px 40px rgba(0,0,0,0.8); }
    .video-container { position:relative; padding-bottom:56.25%; height:0; overflow:hidden; }
    #videoFrameModal { position:absolute; top:0; left:0; width:100%; height:100%; border:none; }
    .info-grid { display:grid; gap:8px; font-size:14px; }
    .info-grid p { margin:0; }
    .info-grid strong { color:#aaa; }

    @media (max-width:380px) {
      .title { font-size:24px; }
      .poster { width:140px; height:210px; }
      .actions { gap:12px; }
      .btn-icon { width:48px; height:48px; }
      .movie-logo { max-width:160px; max-height:50px; }
      .recommended-grid li { flex: 0 0 100px; }
      .recommended-grid .title { font-size: 11px; }
    }
	
	 .recommended-section {
    margin-top: 40px;
  }

  .section-title {
    font-size: 1.4rem;
    font-weight: 600;
    margin-bottom: 15px;
    color: #fff;
    padding-left: 10px;
  }

  .scroll-container {
    overflow-x: auto;
    overflow-y: hidden;
    white-space: nowrap;
    scroll-behavior: smooth;
    padding: 5px 10px 15px;
  }

  .recommended-grid {
    display: flex;
    gap: 12px;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .recommended-grid li {
    flex: 0 0 calc(33.33% - 10px); /* 3 por fila aprox en pantallas medianas */
    max-width: 180px;
    min-width: 120px;
  }

  @media (max-width: 768px) {
    .recommended-grid li {
      flex: 0 0 calc(45% - 10px); /* 2 por fila aprox en móviles */
    }
  }

  @media (max-width: 480px) {
    .recommended-grid li {
      flex: 0 0 calc(60% - 10px); /* más grandes en pantallas pequeñas */
    }
  }

  .recommended-grid img {
    width: 100%;
    aspect-ratio: 2 / 3;
    border-radius: 10px;
    object-fit: cover;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    transition: opacity 0.3s ease;
  }

  .recommended-grid .title {
    margin-top: 6px;
    font-size: 0.9rem;
    color: #ddd;
    text-align: center;
    line-height: 1.2;
    min-height: 35px;
  }

  /* Scrollbar discreto */
  .scroll-container::-webkit-scrollbar {
    height: 6px;
  }

  .scroll-container::-webkit-scrollbar-thumb {
    background: #ff0000;
    border-radius: 0px;
  }

  .scroll-container::-webkit-scrollbar-track {
    background: transparent;
  }
  </style>
</head>
<body>
  <div class="backdrop"></div>
  <div class="container">
    <div class="header">
      <div class="poster"><img src="https://image.tmdb.org/t/p/original/AnPwhS4narxS6fD7fHuhehfnQzz.jpg" alt="LEGO DC Comics Super Heroes: The Flash"></div>
      <img src="https://image.tmdb.org/t/p/w300/3q6JRCbZxGgeq0VpGnaKFjytSbO.png" alt="Logo LEGO DC Comics Super Heroes: The Flash" class="movie-logo">
      <h1 class="title">LEGO DC Comics Super Heroes: The Flash</h1>
      <div class="meta">
        <p><span>Año: 2018</span></p>
        <span class="match">68% para ti</span>
        <span>1h 18min</span>
      </div>
    </div>
    <div class="actions">
      <button class="btn btn-play" id="btnReproducir">
        <div class="btn-icon"><i class="fas fa-play"></i></div><span>Reproducir</span>
      </button>
      <button class="btn" id="btnLista">
        <div class="btn-icon"><i class="fas fa-plus"></i></div><span>Mi lista</span>
      </button>
      <button class="btn" id="btnInfo">
        <div class="btn-icon"><i class="fas fa-info"></i></div><span>Info</span>
      </button>
    </div>
    <button class="btn-download" id="download-btn" data-url="">
      <i class="fas fa-download"></i> Descargar
    </button>
    <div class="synopsis" id="synopsis">
      <div class="synopsis-title">Sinopsis</div>
      <p id="synopsisText">El sol de la mañana brilla sobre la joya de la ciudad de Metrópolis: el edificio del Daily Planet. ¡Pero cuando el Joker decide que el edificio necesita unas reformas, es hora de hacer sonar la Alarma de Problemas porque los ladrillos están a punto de venirse a abajo! La Liga de la Justicia entra en acción, pero mientras la batalla contra el Joker se recrudece, los poderes de Flash empiezan a enloquecer, lo cual le deja atrapado en un bucle temporal. ¡Lo más extraño es que Flash Reverso aparece con su traje amarillo para provocarle a cada paso! ¡Para romper el ciclo y salvar Metrópolis, Flash necesitará toda su velocidad y que le echen una mano (o una pata) los nuevos reclutas de la Liga de la Justicia: Atom, Krypto el superperro y Ace el Bat-sabueso!</p>
      <button id="toggleSynopsis" style="display:none;background:none;border:none;color:#46d369;font-weight:700;cursor:pointer;margin-top:8px;">Ver más</button>
    </div>

    <div class="recommended-section">
  <h2 class="section-title">Recién agregadas</h2>
  <div class="scroll-container">
    <ul class="recommended-grid" id="recommendedList">
      <!-- Se llenará con los últimos 6 -->
    </ul>
  </div>
</div>
    <!-- MODAL INFO -->
    <div id="infoModal">
      <div>
        <button id="closeModal"><i class="fas fa-times"></i></button>
        <div class="info-grid">
          <p><strong>Director:</strong> Ethan Spaulding</p>
          <p><strong>Género:</strong> Aventura, Animación, Comedia, Familia, Ciencia ficción</p>
          <p><strong>País:</strong> United States of America</p>
          <p><strong>Título Original:</strong> LEGO DC Comics Super Heroes: The Flash</p>
          <p><strong>Eslogan:</strong> N/A</p>
          <p><strong>Presupuesto:</strong> $10.000.000</p>
          <p><strong>Ingresos:</strong> $0</p>
          <p><strong>Calificación:</strong> 6.8 / 10</p>
          <p><strong>Duración:</strong> 1h 18min</p>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL VIDEO -->
  <div id="videoModal">
    <div>
      <button id="closeVideoModal"><i class="fas fa-times"></i></button>
      <div class="video-container">
        <iframe id="videoFrameModal" src="" allowfullscreen></iframe>
      </div>
    </div>
  </div>

 <script>
  // === CONFIGURACIÓN ===
  const VIDEO_URL = "";
  const LISTA_KEY = 'miLista';
  const CURRENT_PAGE_URL = window.location.href.split('#')[0].split('?')[0];
  const CATALOG_URL = 'https://raw.githubusercontent.com/lzrdrz10/BETFLIX/main/HOME/Buscador2.html';
  const CURRENT_HREF = 'movie5.html'; // Cambia esto según la película actual

  // Datos de la película actual
  const movieData = {
    title: 'LEGO DC Comics Super Heroes: The Flash',
    year: '2018',
    backdrop: 'https://image.tmdb.org/t/p/original/uSVXTWbdPPpiecRlGvIZrz9gc8Q.jpg',
    poster: 'https://image.tmdb.org/t/p/original/AnPwhS4narxS6fD7fHuhehfnQzz.jpg',
    url: CURRENT_PAGE_URL
  };

  // === ELEMENTOS DOM ===
  const btnReproducir = document.getElementById('btnReproducir');
  const videoModal = document.getElementById('videoModal');
  const videoFrameModal = document.getElementById('videoFrameModal');
  const closeVideoModal = document.getElementById('closeVideoModal');
  const btnLista = document.getElementById('btnLista');
  const btnIcon = btnLista.querySelector('i');
  const btnText = btnLista.querySelector('span');
  const btnInfo = document.getElementById('btnInfo');
  const infoModal = document.getElementById('infoModal');
  const closeModalBtn = document.getElementById('closeModal');
  const synopsisText = document.getElementById('synopsisText');
  const toggleSynopsis = document.getElementById('toggleSynopsis');
  const recommendedList = document.getElementById('recommendedList');

  // === CARGAR ÚLTIMAS 6 PELÍCULAS (FUNCIONAL) ===
  async function loadLatestMovies() {
    try {
      const cacheKey = 'latest_movies_cache_v4';
      const cacheTime = 'latest_movies_time_v4';
      const cached = localStorage.getItem(cacheKey);
      const cacheAge = Date.now() - (localStorage.getItem(cacheTime) || 0);

      let html = cached;
      if (!cached || cacheAge > 3600000) {
        const res = await fetch(CATALOG_URL + '?t=' + Date.now());
        if (!res.ok) throw new Error('No se pudo cargar el catálogo');
        html = await res.text();
        localStorage.setItem(cacheKey, html);
        localStorage.setItem(cacheTime, Date.now());
      }

      // --- Extraer solo la sección debajo de <!--PEGAR CONTENIDO AQUI ABAJO-->
      const seccion = html.split('<!--PEGAR CONTENIDO AQUI ABAJO-->')[1] || '';

      // --- Buscar todos los pares de <!-- título --> + <li> ... </li>
      const regex = /<!--\s*([^>]+?)\s*-->\s*<li>([\s\S]*?)<\/li>/g;
      const movies = [];
      let match;

      while ((match = regex.exec(seccion)) !== null) {
        const title = match[1].trim();
        const liHTML = match[2];
        const parser = new DOMParser();
        const liDoc = parser.parseFromString(`<li>${liHTML}</li>`, 'text/html');
        const a = liDoc.querySelector('a');
        const img = liDoc.querySelector('img');
        if (a && img) {
          const href = a.getAttribute('href');
          const src = img.getAttribute('src');
          if (href && src && !href.includes(CURRENT_HREF)) {
            movies.push({ title, href, src });
          }
        }
      }

      // Tomar los últimos 6
      const latestSix = movies.slice(-6);

      if (latestSix.length > 0) {
        recommendedList.innerHTML = latestSix.map(m => `
          <li>
            <a href="${m.href}" tabindex="0" class="block outline-none focus:ring-2 ring-yellow-400 rounded">
              <img src="${m.src}" alt="poster" class="w-full aspect-[2/3] rounded-lg object-cover" loading="lazy"/>
              <div class="title">${m.title}</div>
            </a>
          </li>
        `).join('');
      } else {
        recommendedList.innerHTML = '<li style="color:#666;font-size:14px;text-align:center;width:100%;">No hay películas disponibles.</li>';
      }
    } catch (err) {
      console.error('Error cargando películas:', err);
      recommendedList.innerHTML = '<li style="color:#666;font-size:14px;text-align:center;width:100%;">Error al cargar.</li>';
    }
  }

  // === MODAL VIDEO ===
  btnReproducir.addEventListener('click', () => {
    videoFrameModal.src = VIDEO_URL;
    videoModal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  });

  const closeVideo = () => {
    videoModal.style.display = 'none';
    videoFrameModal.src = '';
    document.body.style.overflow = '';
  };
  closeVideoModal.addEventListener('click', closeVideo);
  videoModal.addEventListener('click', e => e.target === videoModal && closeVideo());

  // === MODAL INFO ===
  btnInfo.addEventListener('click', () => infoModal.style.display = 'flex');
  closeModalBtn.addEventListener('click', () => infoModal.style.display = 'none');
  infoModal.addEventListener('click', e => e.target === infoModal && (infoModal.style.display = 'none'));

  // === DESCARGA ===
  document.getElementById('download-btn').addEventListener('click', e => {
    e.preventDefault();
    const url = e.currentTarget.dataset.url;
    if (!url) return alert('No hay enlace de descarga');
    const clean = url.replace(/^https?:\/\//, '');
    location.href = 'intent://' + clean + '#Intent;package=idm.internet.download.manager.plus;scheme=https;end';
    setTimeout(() => location.href = 'intent://' + clean + '#Intent;package=idm.internet.download.manager;scheme=https;end', 1000);
  });

  // === SINOPSIS "VER MÁS" ===
  const maxLength = 200;
  if (synopsisText.textContent.length > maxLength) {
    const full = synopsisText.textContent;
    const short = full.slice(0, maxLength) + '...';
    synopsisText.textContent = short;
    toggleSynopsis.style.display = 'inline-block';
    let expanded = false;
    toggleSynopsis.addEventListener('click', () => {
      synopsisText.textContent = expanded ? short : full;
      toggleSynopsis.textContent = expanded ? 'Ver más' : 'Ver menos';
      expanded = !expanded;
    });
  }

  // === MI LISTA ===
  function getLista() {
    try {
      const data = localStorage.getItem(LISTA_KEY);
      return data ? JSON.parse(data) : [];
    } catch { return []; }
  }

  function saveLista(lista) {
    try {
      localStorage.setItem(LISTA_KEY, JSON.stringify(lista));
    } catch (err) {
      console.error('Error al guardar:', err);
    }
  }

  function isInLista(url) {
    return getLista().some(item => item.url === url);
  }

  function updateButton(isAdded) {
    if (isAdded) {
      btnIcon.classList.remove('fa-plus'); btnIcon.classList.add('fa-check');
      btnText.textContent = 'Añadido'; btnLista.classList.add('added');
    } else {
      btnIcon.classList.remove('fa-check'); btnIcon.classList.add('fa-plus');
      btnText.textContent = 'Mi lista'; btnLista.classList.remove('added');
    }
  }

  function toggleLista() {
    const lista = getLista();
    const added = isInLista(CURRENT_PAGE_URL);
    if (added) {
      const filtered = lista.filter(m => m.url !== CURRENT_PAGE_URL);
      saveLista(filtered);
      updateButton(false);
    } else {
      lista.push({ ...movieData, addedAt: new Date().toISOString() });
      saveLista(lista);
      updateButton(true);
    }
  }

  btnLista.addEventListener('click', toggleLista);

  // === INICIALIZAR ===
  document.addEventListener('DOMContentLoaded', () => {
    updateButton(isInLista(CURRENT_PAGE_URL));
    loadLatestMovies();
  });
</script>

</body>
</html>
